<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plyr YouTube and Local Test</title>
    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css">
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
    <h1>Test Plyr with YouTube and Local Videos</h1>

    <!-- Plyr YouTube Video -->
    <h2>YouTube Video</h2>
    <div class="plyr__video-embed" id="youtube-player">
        <iframe
            src="https://www.youtube.com/embed/yYri7s3RCWE?enablejsapi=1&modestbranding=1&rel=0&playsinline=1"
            allowfullscreen
            allow="autoplay; encrypted-media">
        </iframe>
    </div>

    <!-- Plyr Local Video -->
    <h2>Local Video</h2>
    <video id="local-player" class="plyr" playsinline muted controls>
        <source src="static/videos/25%20BEGINNER%20BACHATA%20MOVES%20YOU%20MUST%20KNOW!.mp4" type="video/mp4">
        Your browser does not support HTML5 video.
    </video>

    <!-- Plyr JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.polyfilled.js"></script>
    <script>
        const YT_STATES = {
            '-1': 'Unstarted',
            '0': 'Ended',
            '1': 'Playing',
            '2': 'Paused',
            '3': 'Buffering',
            '5': 'Video Cued',
        };

        class UnifiedPlayer {
            constructor(playerType, elementSelector, isYouTube = false) {
                this.playerType = playerType;
                this.isYouTube = isYouTube;

                // Initialize the player
                if (isYouTube) {
                    this.player = new Plyr(elementSelector, {
                        controls: ['play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'],
                    });
                    this._attachYouTubeEvents();
                } else {
                    this.player = new Plyr(elementSelector, {
                        controls: ['play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'],
                    });
                    this._attachLocalEvents();
                }
            }

            play() {
                this.player.muted = true; // Start muted
                this.player.play();
            }

            _attachLocalEvents() {
                this.player.on('ready', () => {
                    console.log(`${this.playerType} player is ready!`);
                    this.play(); // Start playing
                });

                this.player.on('play', () => console.log(`${this.playerType} video is playing!`));
                this.player.on('pause', () => console.log(`${this.playerType} video is paused!`));
                this.player.on('ended', () => console.log(`${this.playerType} video has ended.`));
            }

            _attachYouTubeEvents() {
                this.player.on('ready', () => {
                    console.log(`${this.playerType} player is ready!`);
                    this.play(); // Start playing
                });

                this.player.on('statechange', (event) => {
                    const stateCode = event.detail?.code;
                    const stateName = YT_STATES[stateCode] || `Unknown (${stateCode})`;
                    console.log(`${this.playerType} Player Event: ${stateName} (${stateCode})`);
                });

                this.player.on('play', () => console.log(`${this.playerType} video is playing!`));
                this.player.on('pause', () => console.log(`${this.playerType} video is paused!`));
                this.player.on('ended', () => console.log(`${this.playerType} video has ended.`));
            }
        }

        // Global function required by the YouTube IFrame API
        function onYouTubeIframeAPIReady() {
            console.log('YouTube IFrame API is ready!');

            // Initialize Unified Players
            const youtubePlayer = new UnifiedPlayer('YouTube', '#youtube-player', true);
            const localPlayer = new UnifiedPlayer('Local', '#local-player');
        }
    </script>    
</body>
</html>
